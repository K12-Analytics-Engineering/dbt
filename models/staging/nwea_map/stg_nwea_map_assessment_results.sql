
SELECT
    district__state_i_d                                      AS district_state_id,
    district_name                                            AS local_education_agency_name,
    school_name                                              AS school_name,
    SPLIT(SPLIT(term_name, "-")[OFFSET(0)], " ")[OFFSET(0)]  AS term_name,
    SPLIT(term_name, "-")[OFFSET(1)]                         AS school_year,
    student_i_d                                              AS student_unique_id,
    student__state_i_d                                       AS student_state_id,
    subject                                                  AS subject,
    REPLACE(course, 'Math K-12', 'Mathematics')              AS course,
    CAST(growth_measure_y_n AS BOOL)                         AS is_growth_measure,
    norms_reference_data	                                 AS norms_reference_data,
    test_i_d                                                 AS test_id,
    test_type                                                AS test_type,
    test_name                                                AS test_name,
    CAST(PARSE_DATE('%m/%d/%Y', test_start_date) AS STRING)  AS test_start_date,
    SAFE_CAST(test_duration_minutes AS int64)                AS test_duration_minutes,
    SAFE_CAST(test_r_i_t_score AS int64)                     AS test_rit_score,
    SAFE_CAST(test_percentile AS int64)                      AS test_percentile,
    SAFE_CAST(percent_correct AS int64)                      AS percent_correct,
    SAFE_CAST(fall_to_winter_projected_growth AS int64)      AS fall_to_winter_projected_growth,
    SAFE_CAST(fall_to_winter_observed_growth AS int64)       AS fall_to_winter_observed_growth,
    IF(
        CONTAINS_SUBSTR(fall_to_winter_met_projected_growth, "Yes"),
        TRUE,
        FALSE
    )                                                        AS met_fall_to_winter_projected_growth,
    goal1_name                                               AS goal1_name,
    goal1_adjective                                          AS goal1_adjective,
    goal1_rit_score                                          AS goal1_rit_score,
    goal2_name                                               AS goal2_name,
    goal2_adjective                                          AS goal2_adjective,
    goal2_rit_score                                          AS goal2_rit_score,
    goal3_name                                               AS goal3_name,
    goal3_adjective                                          AS goal3_adjective,
    goal3_rit_score                                          AS goal3_rit_score,
    goal4_name                                               AS goal4_name,
    goal4_adjective                                          AS goal4_adjective,
    goal4_rit_score                                          AS goal4_rit_score
FROM {{ source('staging', 'base_nwea_map_assessment_results') }}
